(()=>{"use strict";function e(e){return 20*e}function n(n){return{x:e(n.x),y:560-e(n.y)}}function i(i,t,l,o){var r=n(t);i.fillStyle="#000",i.fillRect(r.x,r.y,e(o),-e(l)),i.fillStyle="darkgreen",i.fillRect(r.x+1,r.y+1,e(o)-2,1-e(l))}var t=new Image;function l(e,i){var l=n(i);e.drawImage(t,l.x-31,l.y-46)}function o(e,n,i,t,l,o){var r=t*Math.PI/180;return{x:e+l*Math.cos(r)*i+o/2*i*i,y:n+l*Math.sin(r)*i-4.905*i*i}}function r(e,n){var i=n.x-e.x,t=n.y-e.y;return Math.sqrt(i*i+t*t)}t.src="donkey-kong.png";const s="AnDerReihe",a="Abgeworfen",u="Warten",d="Gewonnen";var c={spieler1:{name:"1",position:null,zustand:s,zeitAbgeworfen:null,winkel:void 0,geschwindigkeit:void 0},spieler2:{name:"2",position:null,zustand:u,zeitAbgeworfen:null,winkel:void 0,geschwindigkeit:void 0},ballPosition:null,loecher:[],haeuser:[],wind:8};function p(){return 20*Math.random()}function g(e,n){c.spieler1.zustand===s&&(c.spieler1.zeitAbgeworfen=new Date,c.spieler1.zustand=a,c.spieler1.winkel=e,c.spieler1.geschwindigkeit=n,c.ballPosition=c.spieler1.position)}function f(){return c.ballPosition.y<0||c.ballPosition.x>50||c.ballPosition.x<0}function h(){if(function(){for(var e of c.loecher)if(r(c.ballPosition,e)<=3)return!0;return!1}())return!1;for(var e=0;e<c.haeuser.length;e++){var n=c.haeuser[e];if(c.ballPosition.x>n.x&&c.ballPosition.x<n.x+n.b&&n.y>c.ballPosition.y)return!0}return!1}function y(e){var n=e.position.x-c.ballPosition.x,i=e.position.y-c.ballPosition.y;return Math.sqrt(n*n+i*i)<=1.5}function m(){var e=new Date;if(c.spieler1.zustand===a){var n=(e.getTime()-c.spieler1.zeitAbgeworfen.getTime())/1e3;c.ballPosition=o(c.spieler1.position.x,c.spieler1.position.y,n,c.spieler1.winkel,c.spieler1.geschwindigkeit,c.wind),y(c.spieler2)?c.spieler1.zustand=d:(h()||f())&&(h()&&c.loecher.push(c.ballPosition),c.spieler1.zustand=u,c.spieler2.zustand=s)}return c.spieler2.zustand===a&&(n=(e.getTime()-c.spieler2.zeitAbgeworfen.getTime())/1e3,c.ballPosition=o(c.spieler2.position.x,c.spieler2.position.y,n,c.spieler2.winkel,c.spieler2.geschwindigkeit,c.wind),y(c.spieler1)?c.spieler2.zustand=d:(h()||f())&&(h()&&c.loecher.push(c.ballPosition),c.spieler1.zustand=s,c.spieler2.zustand=u)),c}var w,b,v=null,x=null;window.onload=function(){var e=document.getElementById("Spielflaeche");(x=document.createElement("canvas")).width=e.width,x.height=e.height,v=x.getContext("2d"),document.getElementById("EingabeButon1").onclick=B,document.getElementById("EingabeButon2").onclick=M,console.log("adding eventhandler "),e.addEventListener("mousedown",I,!1),e.addEventListener("mousemove",P,!1),e.addEventListener("mouseup",E,!1),c.haeuser=[{x:0,y:p(),b:5},{x:5,y:p(),b:5},{x:10,y:p(),b:5},{x:15,y:p(),b:5},{x:20,y:p(),b:5},{x:25,y:p(),b:5},{x:30,y:p(),b:5},{x:35,y:p(),b:5},{x:40,y:p(),b:5},{x:45,y:p(),b:5}],c.spieler1.position={x:c.haeuser[1].x+3,y:c.haeuser[1].y},c.spieler2.position={x:c.haeuser[c.haeuser.length-2].x+3,y:c.haeuser[c.haeuser.length-2].y},c.ballPosition=null,c.loecher=[],document.getElementById("Spieler1Titel").innerHTML="Spieler 1 ist dran",T()};var z=void 0,k=void 0;function I(e){console.log(e),z={x:e.offsetX,y:e.offsetY},k=new Date}function P(e){}function E(e){console.log(e);var i,t={x:e.offsetX,y:e.offsetY},l=(i=k,((new Date).getTime()-i.getTime())/1e3);if(z){var o=function(e,n,i){var t=r(e,n);return{winkel:180*Math.acos(vx/t)/Math.PI,geschwindigkeit:t/(1e3*i)}}(n(z),n(t),l);g(o.winkel,o.geschwindigkeit),z=null}}async function B(){w=parseInt(document.getElementById("EingabeWinkel1").value),b=parseInt(document.getElementById("EingabeGeschwindigkeit1").value),g(w,b)}async function M(){w=parseInt(document.getElementById("EingabeWinkel2").value),b=parseInt(document.getElementById("EingabeGeschwindigkeit2").value),function(e,n){c.spieler2.zustand===s&&(c.spieler2.zeitAbgeworfen=new Date,c.spieler2.zustand=a,c.spieler2.winkel=e,c.spieler2.geschwindigkeit=n,c.ballPosition=c.spieler2.position)}(180-w,b)}function S(e){e.zustand===d?document.getElementById("Info").innerHTML="Spieler"+e.name+" hat gewonnen.":e.zustand===s?document.getElementById("Spieler"+e.name+"Titel").innerHTML="Spieler "+e.name+" ist dran":e.zustand===a?document.getElementById("Spieler"+e.name+"Titel").innerHTML="Spieler "+e.name+" hat geworfen":e.zustand===u&&(document.getElementById("Spieler"+e.name+"Titel").innerHTML="Spieler "+e.name+" wartet")}function T(){var t=m();v.clearRect(0,0,x.width,x.height);var o,r,s,u,d,c=0;for(var p of t.haeuser){const e=p.y,n=p.b;i(v,{x:c,y:0},e,n),c+=n}for(var g of t.loecher)o=v,void 0,void 0,r=n(g),s=e(3),o.beginPath(),o.fillStyle="blue",o.arc(r.x,r.y,s,0,2*Math.PI),o.fill();l(v,t.spieler1.position),l(v,t.spieler2.position),S(t.spieler1),S(t.spieler2),t.spieler1.zustand!==a&&t.spieler2.zustand!==a||function(e,i){var t=n(i);e.beginPath(),e.arc(t.x,t.y,10,0,2*Math.PI),e.fillStyle="red",e.fill()}(v,t.ballPosition),(d=(u=document.getElementById("Spielflaeche")).getContext("2d")).clearRect(0,0,u.width,u.height),d.drawImage(x,0,0),requestAnimationFrame(T)}})();